# iOS è®¾å¤‡ç®¡ç†å™¨ (phone-linkc)

> åŸºäº Qt 6 å’Œ libimobiledevice çš„è·¨å¹³å° iOS è®¾å¤‡ç®¡ç†åº”ç”¨

## ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Qt 6 åº”ç”¨ç¨‹åºï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ libimobiledevice åº“æ¥ç®¡ç† iOS è®¾å¤‡ã€‚è¯¥é¡¹ç›®é‡‡ç”¨**åŠ¨æ€åº“åŠ è½½æŠ€æœ¯**ï¼Œæ”¯æŒåœ¨æœ‰æˆ–æ—  libimobiledevice ç¯å¢ƒä¸‹è¿è¡Œï¼Œæä¾›è®¾å¤‡å‘ç°ã€è¿æ¥ç®¡ç†ã€è®¾å¤‡ä¿¡æ¯è·å–ä»¥åŠ**ç…§ç‰‡ç®¡ç†**ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### ä¸»è¦ç‰¹æ€§

- âœ… **å®æ—¶è®¾å¤‡å‘ç°**: è‡ªåŠ¨æ£€æµ‹è¿æ¥çš„ iOS è®¾å¤‡ï¼ˆæ”¯æŒäº‹ä»¶è®¢é˜…ï¼‰
- âœ… **è®¾å¤‡è¿æ¥ç®¡ç†**: å»ºç«‹å’Œç®¡ç†è®¾å¤‡è¿æ¥
- âœ… **è¯¦ç»†è®¾å¤‡ä¿¡æ¯**: è·å–å®Œæ•´çš„ç¡¬ä»¶å’Œè½¯ä»¶ä¿¡æ¯
- âœ… **ç…§ç‰‡ç®¡ç†**:
    - ğŸ“ **ç›¸å†Œæµè§ˆ**: æ ‘å½¢ç»“æ„æŸ¥çœ‹è®¾å¤‡ä¸Šçš„ç›¸å†Œï¼ˆ/DCIMï¼‰
    - ğŸ–¼ï¸ **ç…§ç‰‡é¢„è§ˆ**: å¼‚æ­¥åŠ è½½ç…§ç‰‡ç¼©ç•¥å›¾ï¼Œæµç•…çš„æ»šåŠ¨ä½“éªŒ
    - ğŸ’¾ **ç…§ç‰‡å¯¼å‡º**: æ”¯æŒå¯¼å‡ºç…§ç‰‡åˆ°æœ¬åœ°ï¼ˆå¼€å‘ä¸­ï¼‰
- âœ… **æ–‡ä»¶ç®¡ç†**:
    - ğŸ“‚ **ç›®å½•æµè§ˆ**: æ ‘å½¢ç»“æ„è®¿é—®è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿ
    - ğŸ“„ **æ–‡ä»¶æ“ä½œ**: æ”¯æŒåˆ›å»ºæ–‡ä»¶å¤¹ã€åˆ é™¤æ–‡ä»¶/ç›®å½•ã€å¯¼å‡ºæ–‡ä»¶
    - ğŸ”„ **å®æ—¶åˆ·æ–°**: åŠ¨æ€æ›´æ–°æ–‡ä»¶åˆ—è¡¨
- âœ… **ç”¨æˆ·å‹å¥½ç•Œé¢**: ç°ä»£åŒ– Qt å›¾å½¢ç•Œé¢ï¼Œè‡ªé€‚åº” FlowLayout å¸ƒå±€
- âœ… **åŠ¨æ€åº“åŠ è½½**: Windows å¹³å°æ™ºèƒ½åŠ è½½ DLLï¼Œæ— éœ€é™æ€é“¾æ¥ï¼Œå¢å¼ºå…¼å®¹æ€§
- âœ… **æ¨¡æ‹Ÿæ¨¡å¼**: æ— éœ€çœŸå®è®¾å¤‡å³å¯æµ‹è¯•ï¼ˆå¼€å‘å‹å¥½ï¼‰
- âœ… **è·¨å¹³å°æ”¯æŒ**: Windowsã€macOSã€Linux å®Œæ•´æ”¯æŒ
- âœ… **æ™ºèƒ½ä¾èµ–ç®¡ç†**: è‡ªåŠ¨æ£€æµ‹å’Œé…ç½® libimobiledevice

## æŠ€æœ¯æ–¹æ¡ˆç»†èŠ‚

### æ ¸å¿ƒæ¶æ„

é¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼š

1.  **UI å±‚ (`src/ui`)**:
    -   ä½¿ç”¨ Qt Widgets æ„å»ºç°ä»£åŒ–ç•Œé¢
    -   `PhotoPage`: è´Ÿè´£ç…§ç‰‡å±•ç¤ºï¼Œå®ç°äº†è‡ªå®šä¹‰ `FlowLayout` ä»¥é€‚åº”ä¸åŒçª—å£å¤§å°
    -   `PhotoThumbnail`: è‡ªå®šä¹‰ Widget ç”¨äºæ˜¾ç¤ºç…§ç‰‡ç¼©ç•¥å›¾å’Œé€‰ä¸­çŠ¶æ€
    -   å¼‚æ­¥åŠ è½½æœºåˆ¶: ä½¿ç”¨ `QTimer` å’Œé˜Ÿåˆ—æœºåˆ¶ï¼Œå°†è€—æ—¶çš„å›¾ç‰‡è¯»å–å’Œè§£ç åˆ†æ•£åˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹

2.  **ä¸šåŠ¡é€»è¾‘å±‚ (`src/core`)**:
    -   `DeviceManager`: è´Ÿè´£è®¾å¤‡çš„å‘ç°å’Œè¿æ¥ç®¡ç†
    -   `PhotoManager`: å°è£…äº†å…·ä½“çš„ç…§ç‰‡æ“ä½œæ¥å£
    -   `DeviceInfoManager`: è´Ÿè´£è·å–å’Œè§£æè®¾å¤‡ä¿¡æ¯

3.  **å¹³å°é€‚é…å±‚ (`src/platform`)**:
    -   `LibimobiledeviceDynamic`: æ ¸å¿ƒç»„ä»¶ï¼Œå®ç°äº† Windows ä¸‹ libimobiledevice åŠå…¶ä¾èµ–åº“ï¼ˆlibplist, libusbmuxd ç­‰ï¼‰çš„åŠ¨æ€åŠ è½½
    -   å°è£…äº† C é£æ ¼çš„ API ä¸º C++ å‹å¥½çš„æ¥å£

### åŠŸèƒ½å®ç°åŸç†

#### 1. è®¾å¤‡å‘ç°ä¸äº‹ä»¶è®¢é˜…

é¡¹ç›®ä½¿ç”¨ libimobiledevice æä¾›çš„äº‹ä»¶è®¢é˜…æœºåˆ¶æ¥å®ç°çƒ­æ’æ‹”æ£€æµ‹ï¼Œè€Œéè½®è¯¢ï¼Œèµ„æºå ç”¨æä½ã€‚

-   **æ ¸å¿ƒ API**: `idevice_event_subscribe` / `idevice_event_unsubscribe`
-   **å®ç°æœºåˆ¶**: `DeviceManager` æ³¨å†Œå›è°ƒå‡½æ•°æ¥æ”¶åº•å±‚è®¾å¤‡äº‹ä»¶ï¼ˆADD/REMOVEï¼‰ï¼Œé€šè¿‡ Qt çš„ä¿¡å·æ§½æœºåˆ¶ (`deviceFound`, `deviceLost`) å°†äº‹ä»¶è½¬å‘åˆ° UI çº¿ç¨‹ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚

#### 2. è®¾å¤‡è¿æ¥ä¸åŠ¨æ€åº“åŠ è½½

é¡¹ç›®é‡‡ç”¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ (`QLibrary`/`LoadLibrary`) çš„æ–¹å¼è°ƒç”¨ `libimobiledevice`ï¼Œè€Œéç¼–è¯‘æ—¶é™æ€é“¾æ¥ã€‚è¿™ä½¿å¾—åº”ç”¨åœ¨æœªå®‰è£…é©±åŠ¨çš„æœºå™¨ä¸Šä¹Ÿèƒ½è¿è¡Œï¼ˆä»…åŠŸèƒ½å—é™ï¼‰ï¼Œæå¤§æé«˜äº†å…¼å®¹æ€§ã€‚

-   **æ ¸å¿ƒç±»**: `LibimobiledeviceDynamic` (å•ä¾‹æ¨¡å¼)
-   **åŠ è½½æµç¨‹**:
    1.  æ£€æµ‹ç³»ç»Ÿç¯å¢ƒå˜é‡å’Œé¢„å®šä¹‰è·¯å¾„ã€‚
    2.  æŒ‰é¡ºåºåŠ è½½ä¾èµ–åº“ï¼š`libplist` -> `libusbmuxd` -> `libimobiledevice`ã€‚
    3.  ä½¿ç”¨ `resolve` è§£æç¬¦å·å¹¶æ˜ å°„åˆ°å‡½æ•°æŒ‡é’ˆã€‚
-   **è¿æ¥æµç¨‹**:
    1.  `idevice_new`: åˆ›å»ºè®¾å¤‡å¥æŸ„ã€‚
    2.  `lockdownd_client_new_with_handshake`: å»ºç«‹å—ä¿¡è¿æ¥ï¼ˆéœ€ç”¨æˆ·åœ¨æ‰‹æœºä¸Šç‚¹å‡»â€œä¿¡ä»»â€ï¼‰ã€‚
    3.  `lockdownd_start_service`: å¯åŠ¨ç‰¹å®šæœåŠ¡ï¼ˆå¦‚ `com.apple.afc` ç”¨äºæ–‡ä»¶è®¿é—®ï¼‰ã€‚

#### 3. ç…§ç‰‡ç®¡ç†å®ç°ç»†èŠ‚

-   **æ–‡ä»¶ç³»ç»Ÿè®¿é—®**: é€šè¿‡ libimobiledevice çš„ AFC (Apple File Conduit) æœåŠ¡è®¿é—® iOS è®¾å¤‡çš„ `/DCIM` ç›®å½•ã€‚
-   **ç›¸å†Œè§£æ**: é€’å½’æ‰«æ `/DCIM` ä¸‹çš„æ–‡ä»¶å¤¹ï¼ˆå¦‚ `100APPLE`ï¼‰ï¼Œå°†å…¶æ˜ å°„ä¸ºç›¸å†Œç»“æ„ã€‚
-   **ç¼©ç•¥å›¾ç”Ÿæˆ**:
    -   ç›®å‰é€šè¿‡è¯»å–åŸå§‹ç…§ç‰‡æ–‡ä»¶ (`readPhotoData`) å¹¶ä½¿ç”¨ `QImage` è¿›è¡Œè§£ç å’Œç¼©æ”¾ç”Ÿæˆç¼©ç•¥å›¾ã€‚
    -   **å¼‚æ­¥é˜Ÿåˆ—**: å®ç°äº† `startThumbnailLoading` å’Œ `loadNextThumbnail`ï¼Œé˜²æ­¢ä¸€æ¬¡æ€§åŠ è½½å¤§é‡å›¾ç‰‡å¯¼è‡´ç•Œé¢å¡æ­»ã€‚
-   **HEIC æ”¯æŒ**: ä¾èµ– Qt çš„ Imageformats æ’ä»¶ã€‚å¦‚æœç³»ç»Ÿç¼ºå¤± HEIC è§£ç å™¨,ç¼©ç•¥å›¾å¯èƒ½æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼ˆæ˜¾ç¤ºä¸ºç°è‰²å ä½ç¬¦ï¼‰ã€‚

##### å·²çŸ¥é™åˆ¶

1.  **HEIC æ ¼å¼æ”¯æŒ**:
    -   iPhone æ‹æ‘„çš„ç…§ç‰‡é»˜è®¤ä¸º HEIC æ ¼å¼ã€‚
    -   Windows ä¸Šçš„ Qt é»˜è®¤å¯èƒ½ä¸æ”¯æŒ HEIC è§£ç ï¼Œå¯¼è‡´ç¼©ç•¥å›¾æ˜¾ç¤ºå¤±è´¥ã€‚
    -   **è§£å†³æ–¹æ¡ˆ**: éœ€è¦å®‰è£… Qt çš„ HEIF æ’ä»¶æˆ–å°† HEIF è§£ç åº“é›†æˆåˆ°é¡¹ç›®ä¸­ã€‚
2.  **å¤§æ–‡ä»¶è¯»å–æ€§èƒ½**:
    -   ç›®å‰ç”Ÿæˆç¼©ç•¥å›¾æ˜¯è¯»å–æ•´ä¸ªåŸå§‹å›¾ç‰‡æ–‡ä»¶ã€‚å¯¹äºé«˜æ¸…ç…§ç‰‡æˆ–è§†é¢‘ï¼Œå³ä½¿åœ¨å¼‚æ­¥é˜Ÿåˆ—ä¸­è¯»å–ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿè½»å¾®çš„ IO å»¶è¿Ÿã€‚
    -   **ä¼˜åŒ–æ–¹å‘**: å°è¯•è¯»å–æ–‡ä»¶å¤´éƒ¨å…ƒæ•°æ®ä¸­çš„ç¼©ç•¥å›¾ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œæˆ–é›†æˆæ›´é«˜æ•ˆçš„ç¼©ç•¥å›¾ç”Ÿæˆåº“ã€‚
3.  **è§†é¢‘é¢„è§ˆ**:
    -   ç›®å‰è§†é¢‘æ–‡ä»¶ä»…æ˜¾ç¤ºå ä½ç¬¦ï¼Œä¸æ”¯æŒé¢„è§ˆæ’­æ”¾ã€‚
4.  **ç›¸å†Œåç§°**:
    -   æ˜¾ç¤ºçš„ç›¸å†Œåç§°ä¸ºæ–‡ä»¶ç³»ç»Ÿç›®å½•åï¼ˆå¦‚ `100APPLE`ï¼‰ï¼Œè€Œé iOS ç›¸å†Œåº”ç”¨ä¸­æ˜¾ç¤ºçš„é€»è¾‘ç›¸å†Œåï¼ˆå¦‚"æœ€è¿‘é¡¹ç›®"ã€"æ”¶è—"ï¼‰ã€‚è¿™æ˜¯ç”±äº AFC åè®®é™åˆ¶ï¼Œæ— æ³•ç›´æ¥è®¿é—® Photos æ•°æ®åº“ã€‚

#### 4. æ–‡ä»¶ç®¡ç†å®ç°ç»†èŠ‚

æ–‡ä»¶ç®¡ç†åŠŸèƒ½åŸºäº AFC (Apple File Conduit) åè®®å®ç°ã€‚

**æ ¸å¿ƒ AFC API**

| åŠŸèƒ½ | API | è¯´æ˜ |
|------|-----|------|
| å»ºç«‹è¿æ¥ | `lockdownd_start_service("com.apple.afc")` + `afc_client_new()` | å¯åŠ¨ AFC æœåŠ¡å¹¶åˆ›å»ºå®¢æˆ·ç«¯ |
| æµè§ˆç›®å½• | `afc_read_directory()` + `afc_get_file_info()` | è·å–ç›®å½•åˆ—è¡¨å’Œæ–‡ä»¶ä¿¡æ¯ |
| åˆ›å»ºç›®å½• | `afc_make_directory()` | åˆ›å»ºå•å±‚ç›®å½• |
| åˆ é™¤ | `afc_remove_path()` | åˆ é™¤æ–‡ä»¶æˆ–ç©ºç›®å½• |
| é‡å‘½å | `afc_rename_path()` | æ–‡ä»¶/ç›®å½•é‡å‘½å |
| è¯»å–æ–‡ä»¶ | `afc_file_open()` + `afc_file_read()` + `afc_file_close()` | æµå¼è¯»å–æ–‡ä»¶ |
| å†™å…¥æ–‡ä»¶ | `afc_file_open()` + `afc_file_write()` + `afc_file_close()` | æµå¼å†™å…¥æ–‡ä»¶ |

##### å·²çŸ¥é™åˆ¶

1.  **æ–‡ä»¶å¯¼å…¥åŠŸèƒ½**:
    -   ç›®å‰å¯¼å…¥åŠŸèƒ½çš„ UI å·²å°±ç»ªï¼Œä½†å®é™…çš„æ–‡ä»¶ä¸Šä¼ é€»è¾‘å°šæœªå®ç°ã€‚
    -   **å®ç°è®¡åˆ’**: éœ€è¦å®ç° `FileManager::writeFile()` çš„å®Œæ•´é€»è¾‘ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ‰“å¼€ã€å†™å…¥å’Œå…³é—­ã€‚
2.  **ç›®å½•é€’å½’åˆ é™¤**:
    -   `afc_remove_path` åªèƒ½åˆ é™¤ç©ºç›®å½•æˆ–å•ä¸ªæ–‡ä»¶ã€‚
    -   å¯¹äºéç©ºç›®å½•ï¼Œéœ€è¦å®ç°é€’å½’åˆ é™¤é€»è¾‘ã€‚
3.  **å¤§æ–‡ä»¶ä¼ è¾“æ€§èƒ½**:
    -   å½“å‰å®ç°ä¸€æ¬¡æ€§è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜ï¼Œå¯¹äºå¤§æ–‡ä»¶å¯èƒ½å¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ã€‚
    -   **ä¼˜åŒ–æ–¹å‘**: å®ç°åˆ†å—ä¼ è¾“æœºåˆ¶ï¼Œä½¿ç”¨ç¼“å†²åŒºè¿›è¡Œæµå¼è¯»å†™ã€‚
4.  **è®¿é—®æƒé™é™åˆ¶**:
    -   AFC æœåŠ¡é»˜è®¤åªèƒ½è®¿é—®åº”ç”¨æ²™ç›’ç›®å½•ï¼Œæ— æ³•è®¿é—®ç³»ç»Ÿç›®å½•æˆ–å…¶ä»–åº”ç”¨çš„æ•°æ®ã€‚
    -   æŸäº›ç›®å½•ï¼ˆå¦‚ç³»ç»Ÿæ ¹ç›®å½•ï¼‰å¯èƒ½è¿”å›æƒé™é”™è¯¯ã€‚

### å¸¸è§ç¼–è¯‘é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

åœ¨å®ç°æ–‡ä»¶ç®¡ç†åŠŸèƒ½çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½é‡åˆ°ä»¥ä¸‹ç¼–è¯‘é”™è¯¯ï¼š

#### 1. AFC å‡½æ•°æœªå®šä¹‰é”™è¯¯

**é”™è¯¯ä¿¡æ¯:**
```
error: 'afc_make_directory' is not a member of 'LibimobiledeviceDynamic'
error: 'afc_remove_path' is not a member of 'LibimobiledeviceDynamic'
error: 'afc_rename_path' is not a member of 'LibimobiledeviceDynamic'
```

**åŸå› :** è¿™äº› AFC å‡½æ•°æŒ‡é’ˆæœªåœ¨ `LibimobiledeviceDynamic` ç±»ä¸­å®šä¹‰ã€‚

**è§£å†³æ–¹æ¡ˆ:**

1. åœ¨ `src/platform/afc_dynamic.h` ä¸­æ·»åŠ å‡½æ•°æŒ‡é’ˆç±»å‹å®šä¹‰ï¼š
```cpp
// ç›®å½•æ“ä½œ
typedef afc_error_t (*afc_make_directory_func)(afc_client_t client, const char *path);
typedef afc_error_t (*afc_remove_path_func)(afc_client_t client, const char *path);
typedef afc_error_t (*afc_rename_path_func)(afc_client_t client, const char *from, const char *to);

// æ–‡ä»¶å†™å…¥
typedef afc_error_t (*afc_file_write_func)(afc_client_t client, uint64_t handle,
                                           const char *data, uint32_t length, uint32_t *bytes_written);
```

2. åœ¨ `src/platform/libimobiledevice_dynamic.h` ä¸­æ·»åŠ æˆå‘˜å˜é‡ï¼š
```cpp
class LibimobiledeviceDynamic {
public:
    // ... ç°æœ‰æˆå‘˜ ...
    
    // AFC æ–‡ä»¶æ“ä½œå‡½æ•°
    afc_make_directory_func afc_make_directory;
    afc_remove_path_func afc_remove_path;
    afc_rename_path_func afc_rename_path;
    afc_file_write_func afc_file_write;
};
```

3. åœ¨ `src/platform/libimobiledevice_dynamic.cpp` çš„ `initialize()` æ–¹æ³•ä¸­åŠ è½½å‡½æ•°ï¼š
```cpp
bool LibimobiledeviceDynamic::initialize() {
    // ... ç°æœ‰ä»£ç  ...
    
    // åŠ è½½ AFC æ‰©å±•å‡½æ•°
    afc_make_directory = resolve<afc_make_directory_func>("afc_make_directory");
    afc_remove_path = resolve<afc_remove_path_func>("afc_remove_path");
    afc_rename_path = resolve<afc_rename_path_func>("afc_rename_path");
    afc_file_write = resolve<afc_file_write_func>("afc_file_write");
    
    return true;
}
```

4. åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ä¸º nullptrï¼š
```cpp
LibimobiledeviceDynamic::LibimobiledeviceDynamic()
    : afc_make_directory(nullptr)
    , afc_remove_path(nullptr)
    , afc_rename_path(nullptr)
    , afc_file_write(nullptr)
{
    // ... ç°æœ‰ä»£ç  ...
}
```

#### 2. æ–¹æ³•åä¸åŒ¹é…é”™è¯¯

**é”™è¯¯ä¿¡æ¯:**
```
error: 'class FileManager' has no member named 'disconnectFromDevice'
```

**åŸå› :** æ–¹æ³•ååœ¨å¤´æ–‡ä»¶å’Œå®ç°æ–‡ä»¶ä¸­ä¸ä¸€è‡´ã€‚

**è§£å†³æ–¹æ¡ˆ:** ç¡®ä¿æ–¹æ³•ååœ¨ä»¥ä¸‹ä½ç½®ä¿æŒä¸€è‡´ï¼š
- `src/core/file/filemanager.h` - æ–¹æ³•å£°æ˜
- `src/core/file/filemanager.cpp` - æ–¹æ³•å®ç°
- `src/ui/mainwindow.cpp` - æ–¹æ³•è°ƒç”¨

æ­£ç¡®çš„å‘½ååº”ä¸º `disconnectFromDevice()` è€Œé `disconnect()`ã€‚

#### 3. MOC æ–‡ä»¶ç”Ÿæˆé—®é¢˜

**ç—‡çŠ¶:** ç¼–è¯‘æ—¶æç¤ºæ‰¾ä¸åˆ° moc æ–‡ä»¶æˆ–ä¿¡å·æ§½è¿æ¥å¤±è´¥ã€‚

**è§£å†³æ–¹æ¡ˆ:**

1. ç¡®ä¿ç±»å£°æ˜ä¸­åŒ…å« `Q_OBJECT` å®ï¼š
```cpp
class FilePage : public QWidget
{
    Q_OBJECT  // å¿…é¡»æ·»åŠ è¿™ä¸€è¡Œ
    
public:
    // ...
};
```

2. ç¡®ä¿æºæ–‡ä»¶å·²åœ¨ `CMakeLists.txt` ä¸­æ­£ç¡®æ³¨å†Œï¼š
```cmake
qt_add_executable(phone-linkc
    # ... ç°æœ‰æ–‡ä»¶ ...
    src/core/file/filemanager.h
    src/core/file/filemanager.cpp
    src/ui/filepage.h
    src/ui/filepage.cpp
    src/ui/filepage.ui
)
```

3. æ¸…ç†æ„å»ºç›®å½•å¹¶é‡æ–°æ„å»ºï¼š
```bash
rm -rf build/
mkdir build && cd build
cmake ..
cmake --build .
```

#### 4. å¤´æ–‡ä»¶åŒ…å«é—®é¢˜

**é”™è¯¯ä¿¡æ¯:**
```
error: 'FileManager' was not declared in this scope
error: incomplete type 'FileManager' used in nested name specifier
```

**è§£å†³æ–¹æ¡ˆ:** æ£€æŸ¥å¤´æ–‡ä»¶åŒ…å«é¡ºåºå’Œå‰å‘å£°æ˜ï¼š

```cpp
// mainwindow.h
#include "core/file/filemanager.h"  // å®Œæ•´åŒ…å«ï¼Œä¸è¦åªç”¨å‰å‘å£°æ˜

class MainWindow : public QMainWindow
{
    Q_OBJECT
    
private:
    FileManager* m_fileManager;  // ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨
};
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

**å¿…éœ€ä¾èµ–:**
- Qt 6.5+
- CMake 3.19+
- C++17 ç¼–è¯‘å™¨

**å¯é€‰ä¾èµ– (æ¨è):**
- libimobiledevice (ç”¨äºçœŸå® iOS è®¾å¤‡æ”¯æŒ)
- libplist
- libusbmuxd

### 2. å®‰è£…ä¾èµ–

#### macOS (Homebrew)
```bash
# å¿…éœ€ç»„ä»¶
brew install qt6 cmake

# å¯é€‰ - iOS è®¾å¤‡æ”¯æŒ
brew install libimobiledevice libplist libusbmuxd
```

#### Ubuntu/Debian
```bash
# å¿…éœ€ç»„ä»¶
sudo apt-get install qt6-base-dev qt6-tools-dev cmake

# å¯é€‰ - iOS è®¾å¤‡æ”¯æŒ
sudo apt-get install libimobiledevice-dev libplist-dev libusbmuxd-dev
```

#### Windows
```powershell
# ä½¿ç”¨ vcpkg (æ¨è)
vcpkg install qt6 cmake

# å¯é€‰ - iOS è®¾å¤‡æ”¯æŒ
vcpkg install libimobiledevice libplist libusbmuxd
```

### 3. ç¼–è¯‘å’Œè¿è¡Œ

#### ä½¿ç”¨æ„å»ºè„šæœ¬ (æ¨è)

**Linux/macOS:**
```bash
./build.sh
```

**Windows:**
```cmd
build.bat
```

æ„å»ºè„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ£€æµ‹ç³»ç»Ÿä¸­çš„ Qt å®‰è£…
- æŸ¥æ‰¾å¸¸è§çš„ Qt è·¯å¾„ï¼ˆåŒ…æ‹¬ ~/Qt ç›®å½•ï¼‰
- é…ç½®åˆé€‚çš„ CMake å‚æ•°
- ç¼–è¯‘å¹¶å¯é€‰æ‹©è¿è¡Œé¡¹ç›®

#### æ‰‹åŠ¨ç¼–è¯‘

```bash
# åˆ›å»ºæ„å»ºç›®å½•
mkdir build && cd build

# é…ç½®é¡¹ç›®
cmake .. -DCMAKE_BUILD_TYPE=Release

# ç¼–è¯‘
cmake --build . --config Release

# è¿è¡Œ
./phone-linkc          # Linux/macOS
# æˆ–
Release/phone-linkc.exe  # Windows
```

## ä½¿ç”¨è¯´æ˜

### ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ iOS è®¾å¤‡ç®¡ç†å™¨ - libimobiledevice ç¤ºä¾‹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¾å¤‡åˆ—è¡¨        â”‚ ğŸ“· å›¾åº“ (æ‰€æœ‰ç…§ç‰‡)                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                        â”‚
â”‚ â”‚ iPhone 15   â”‚  â”‚ [ç…§ç‰‡1] [ç…§ç‰‡2] [ç…§ç‰‡3] [ç…§ç‰‡4]        â”‚
â”‚ â”‚ 00000000... â”‚  â”‚                                        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ [ç…§ç‰‡5] [ç…§ç‰‡6] ...                    â”‚
â”‚                  â”‚                                        â”‚
â”‚ ğŸ“ æˆ‘çš„ç›¸ç°¿      â”‚                                        â”‚
â”‚  â”œâ”€ 100APPLE     â”‚                                        â”‚
â”‚  â””â”€ 101APPLE     â”‚                                        â”‚
â”‚                  â”‚ çŠ¶æ€: æ­£åœ¨åŠ è½½ç¼©ç•¥å›¾...                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çŠ¶æ€æ : æ‰¾åˆ° 2155 å¼ ç…§ç‰‡                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŸºæœ¬æ“ä½œ

1. **è®¾å¤‡å‘ç°**: åº”ç”¨å¯åŠ¨åè‡ªåŠ¨å¼€å§‹æ‰«æ iOS è®¾å¤‡
2. **é€‰æ‹©è®¾å¤‡**: åœ¨å·¦ä¾§åˆ—è¡¨ä¸­ç‚¹å‡»è®¾å¤‡åç§°
3. **è¿æ¥è®¾å¤‡**: ç‚¹å‡»"è¿æ¥è®¾å¤‡"æŒ‰é’®å»ºç«‹è¿æ¥
4. **æµè§ˆç…§ç‰‡**: è¿æ¥æˆåŠŸåï¼Œç‚¹å‡»å·¦ä¾§ç›¸å†Œæ ‘æŸ¥çœ‹ä¸åŒæ–‡ä»¶å¤¹ä¸­çš„ç…§ç‰‡
5. **åˆ·æ–°åˆ—è¡¨**: ç‚¹å‡»"åˆ·æ–°"æ‰‹åŠ¨åŒæ­¥ç…§ç‰‡åˆ—è¡¨

## é¡¹ç›®ç»“æ„

```
phone-linkc/
â”œâ”€â”€ CMakeLists.txt          # CMake æ„å»ºé…ç½®
â”œâ”€â”€ build.sh               # Linux/macOS æ„å»ºè„šæœ¬
â”œâ”€â”€ build.bat              # Windows æ„å»ºè„šæœ¬
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ main.cpp               # åº”ç”¨ç¨‹åºå…¥å£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ device/        # è®¾å¤‡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ photo/         # ç…§ç‰‡ç®¡ç†
â”‚   â”‚   â””â”€â”€ file/          # æ–‡ä»¶ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ filemanager.h/cpp  # æ–‡ä»¶ç³»ç»Ÿæ“ä½œå°è£…
â”‚   â”œâ”€â”€ platform/          # å¹³å°ç›¸å…³ (åŠ¨æ€åº“åŠ è½½)
â”‚   â”‚   â”œâ”€â”€ libimobiledevice_dynamic.h/cpp  # åŠ¨æ€åº“åŠ è½½å™¨
â”‚   â”‚   â”œâ”€â”€ afc_dynamic.h  # AFC å‡½æ•°æŒ‡é’ˆå®šä¹‰
â”‚   â”‚   â”œâ”€â”€ plist_dynamic.h  # Plist å‡½æ•°æŒ‡é’ˆå®šä¹‰
â”‚   â”‚   â””â”€â”€ lockdown_dynamic.h  # Lockdown å‡½æ•°æŒ‡é’ˆå®šä¹‰
â”‚   â””â”€â”€ ui/                # ç”¨æˆ·ç•Œé¢
â”‚       â”œâ”€â”€ photopage.*    # ç…§ç‰‡é¡µé¢ä¸ç¼©ç•¥å›¾å®ç°
â”‚       â”œâ”€â”€ filepage.*     # æ–‡ä»¶ç®¡ç†é¡µé¢å®ç°
â”‚       â”œâ”€â”€ flowlayout.*   # æµå¼å¸ƒå±€å®ç°
â”‚       â””â”€â”€ ...
â””â”€â”€ phone-linkc_zh_CN.ts   # ä¸­æ–‡æœ¬åœ°åŒ–
```

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼ç‰¹åˆ«æ˜¯é’ˆå¯¹ HEIC è§£ç æ”¯æŒå’Œæ€§èƒ½ä¼˜åŒ–çš„æ”¹è¿›ã€‚

---

ğŸ“± äº«å— iOS è®¾å¤‡ç®¡ç†çš„ä¾¿åˆ©ï¼
